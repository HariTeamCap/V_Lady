<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>V Lady Orders Terminal</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f8f9fa;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #ff0077;
      font-weight: 600;
    }

    table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    thead {
      background: #ff0077;
      color: white;
    }

    .timestamp {
      color: gray;
      font-size: 0.9em;
    }

    .sort-controls {
      text-align: center;
      margin-bottom: 20px;
    }

    .product-list {
      background: #fff8f8;
      border-radius: 6px;
      padding: 6px;
      font-size: 0.9em;
    }

    .product-item {
      border-bottom: 1px dashed #ddd;
      padding: 4px 0;
    }

    .product-item:last-child {
      border-bottom: none;
    }

    .coupon-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 500;
      color: white;
    }

    .coupon-used {
      background-color: #ff0077;
    }

    .coupon-none {
      background-color: gray;
    }

    /* ===== Responsive Card View for Mobile ===== */
    @media (max-width: 768px) {
      table {
        display: none;
      }

      .order-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        padding: 15px;
        margin-bottom: 15px;
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .order-header h5 {
        color: #ff0077;
        font-weight: 600;
        margin: 0;
      }

      .order-info {
        font-size: 0.9em;
        margin-top: 10px;
      }

      .order-info strong {
        color: #333;
      }

      .product-list {
        margin-top: 10px;
      }

      .timestamp {
        font-size: 0.8em;
      }
    }
  </style>
</head>
<body>
  <h1>üì¶ V Lady Orders Terminal</h1>

  <!-- Sorting Buttons -->
  <div class="sort-controls">
    <button id="sort-latest" class="btn btn-dark btn-sm me-2">Sort: Latest First</button>
    <button id="sort-oldest" class="btn btn-outline-dark btn-sm">Sort: Oldest First</button>
  </div>

  <!-- Desktop Table View -->
  <div class="container d-none d-md-block">
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>Customer</th>
          <th>Phone</th>
          <th>Address</th>
          <th>Total (‚Çπ)</th>
          <th>Payment</th>
          <th>Status</th>
          <th>Coupon Used</th>
          <th>Date</th>
          <th>Items</th>
        </tr>
      </thead>
      <tbody id="orders-table">
        <tr><td colspan="9" class="text-center">Loading orders...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Mobile Card View -->
  <div class="container d-md-none">
    <div id="orders-cards"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { 
      getFirestore, collection, query, orderBy, getDocs 
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    // ‚úÖ Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB_8hb_E4zqF9sbv8sSx31ZcLXGC5SvSAM",
      authDomain: "studio-1046644394-281ce.firebaseapp.com",
      projectId: "studio-1046644394-281ce",
      storageBucket: "studio-1046644394-281ce.firebasestorage.app",
      messagingSenderId: "722558821135",
      appId: "1:722558821135:web:e67939ec381bf1922b547a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const ordersTable = document.getElementById("orders-table");
    const ordersCards = document.getElementById("orders-cards");
    const sortLatestBtn = document.getElementById("sort-latest");
    const sortOldestBtn = document.getElementById("sort-oldest");

    let currentSort = "desc"; // default: latest first

    async function loadOrders() {
      ordersTable.innerHTML = "<tr><td colspan='9' class='text-center'>Loading orders...</td></tr>";
      ordersCards.innerHTML = "<div class='text-center text-muted'>Loading orders...</div>";

      const q = query(collection(db, "orders"), orderBy("createdAt", currentSort));
      const querySnapshot = await getDocs(q);

      if (querySnapshot.empty) {
        ordersTable.innerHTML = "<tr><td colspan='9' class='text-center'>No orders found.</td></tr>";
        ordersCards.innerHTML = "<div class='text-center text-muted'>No orders found.</div>";
        return;
      }

      let tableRows = "";
      let cardHTML = "";

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const createdAt = data.createdAt?.toDate ? data.createdAt.toDate() : null;
        const formattedDate = createdAt
          ? createdAt.toLocaleString("en-IN", { dateStyle: "medium", timeStyle: "short" })
          : "N/A";

        // üëú Product Details
        let productHTML = "";
        if (Array.isArray(data.items)) {
          data.items.forEach(item => {
            productHTML += `
              <div class="product-item">
                <strong>${item.name}</strong><br>
                Category: ${item.category || "N/A"}<br>
                Qty: ${item.quantity || 1}<br>
                Price: ‚Çπ${item.price}
              </div>
            `;
          });
        }

        // üéüÔ∏è Coupon Badge
        const couponBadge = data.couponUsed && data.couponUsed !== "None"
          ? `<span class="coupon-badge coupon-used">${data.couponUsed}</span>`
          : `<span class="coupon-badge coupon-none">None</span>`;

        // Desktop Row
        tableRows += `
          <tr>
            <td>${data.customerName}</td>
            <td>${data.customerPhone}</td>
            <td>${data.address}</td>
            <td>${data.totalAmount}</td>
            <td>${data.paymentMethod}</td>
            <td>${data.status}</td>
            <td>${couponBadge}</td>
            <td class="timestamp">${formattedDate}</td>
            <td><div class="product-list">${productHTML}</div></td>
          </tr>
        `;

        // Mobile Card
        cardHTML += `
          <div class="order-card">
            <div class="order-header">
              <h5>${data.customerName}</h5>
              <span class="badge bg-${data.status === "Completed" ? "success" : "warning"}">${data.status}</span>
            </div>
            <div class="order-info">
              <strong>Phone:</strong> ${data.customerPhone}<br>
              <strong>Address:</strong> ${data.address}<br>
              <strong>Total:</strong> ‚Çπ${data.totalAmount}<br>
              <strong>Payment:</strong> ${data.paymentMethod}<br>
              <strong>Coupon:</strong> ${couponBadge}<br>
              <strong>Date:</strong> <span class="timestamp">${formattedDate}</span>
            </div>
            <div class="product-list mt-2">${productHTML}</div>
          </div>
        `;
      });

      ordersTable.innerHTML = tableRows;
      ordersCards.innerHTML = cardHTML;
    }

    // Sorting button actions
    sortLatestBtn.addEventListener("click", () => {
      currentSort = "desc";
      sortLatestBtn.classList.replace("btn-outline-dark", "btn-dark");
      sortOldestBtn.classList.replace("btn-dark", "btn-outline-dark");
      loadOrders();
    });

    sortOldestBtn.addEventListener("click", () => {
      currentSort = "asc";
      sortOldestBtn.classList.replace("btn-outline-dark", "btn-dark");
      sortLatestBtn.classList.replace("btn-dark", "btn-outline-dark");
      loadOrders();
    });

    // Initial load
    loadOrders();
  </script>
</body>
</html>