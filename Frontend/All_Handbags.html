<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>V LADY | All Handbags</title>
  <link rel="stylesheet" href="accessories.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <style>
    footer.site-footer {
      width: 100%;
      padding: 20px;
      text-align: center;
      background: white;
      color: black;
      margin-top: 100px;
    }
    @media (min-width: 768px) {
      footer.site-footer { font-size: 29px; }
    }
  </style>
</head>

<body>
<header>
  <div class="logo">V LADY<div class="tagline">Versatile Lady</div></div>
  <nav>
    <ul class="nav-links">
      <li><a href="index.html"><i class="fa fa-house-chimney"></i></a></li>
      <li><a href="about.html"><i class="fa fa-circle-info"></i></a></li>
      <li><a href="cart.html"><i class="fa-solid fa-cart-shopping"></i></a></li>
      <li><a href="mainpage.html"><i class="fa fa-envelope"></i></a></li>
    </ul>
  </nav>
</header>

<div id="bannerText">THE LADY WHO LEADS</div>

<main class="bag-section">
  <h2>ALL HANDBAGS</h2>

  <!-- ‚úÖ View Toggle Buttons -->
  <div class="view-toggle">
    <button class="view-btn" data-columns="1" title="1 per row">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" />
      </svg>
    </button>
    <button class="view-btn active" data-columns="2" title="2 per row">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" />
        <line x1="3" y1="12" x2="21" y2="12" />
        <line x1="12" y1="3" x2="12" y2="21" />
      </svg>
    </button>
    <button class="view-btn wishlist-btn-toggle" title="View Wishlist" 
            onclick="window.location.href='wishlist.html'" 
            style="font-size:22px; color:#ff4d6d;">
      ‚ù§Ô∏è
    </button>
  </div>

  <div class="product-container view-2"></div>
</main>

<footer class="site-footer">
  <p>¬© 2025 V Lady. All rights reserved.</p>
</footer>

<!-- ‚úÖ FIREBASE SCRIPT -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

// üîπ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyB_8hb_E4zqF9sbv8sSx31ZcLXGC5SvSAM",
  authDomain: "studio-1046644394-281ce.firebaseapp.com",
  projectId: "studio-1046644394-281ce",
  storageBucket: "studio-1046644394-281ce.firebasestorage.app",
  messagingSenderId: "722558821135",
  appId: "1:722558821135:web:e67939ec381bf1922b547a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ‚úÖ Add to Cart (Universal)
function addToCartUniversal(product) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  const normalize = (val) => val ? val.toString().trim().toLowerCase() : "";
  const uniqueKey = `${normalize(product.id)}-${normalize(product.name)}-${normalize(product.category)}-${product.price}`;
  product.uniqueKey = uniqueKey;

  const existing = cart.find(item => item.uniqueKey === uniqueKey);
  if (existing) existing.quantity += 1;
  else {
    product.quantity = 1;
    cart.push(product);
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  alert(`${product.name} added to cart üõí`);
}

// ‚úÖ Load All Handbags
async function loadAllHandbags() {
  const container = document.querySelector(".product-container");
  container.innerHTML = "<p>Loading products...</p>";

  // üëú Includes categories with & without spaces
  const categories = [
    "PieBags", "PieBags ",
    "CandyBags", "CandyBags ",
    "Clutches", "Clutches ",
    "Accessories", "Accessories "
  ];

  const allProducts = [];

  try {
    for (const category of categories) {
      const ref = collection(db, "Vlady", category, "Products");
      const snap = await getDocs(ref);

      snap.forEach(doc => {
        const data = doc.data();
        const name = data["Name "] || data["Name"] || "Unnamed Product";
        const price = parseFloat(data["Price "] || data["Price"] || 0);
        const mrp = parseFloat(data["MRP "] || data["MRP"] || 0);
        const description = data["Description "] || data["Description"] || "";
        const images = data["Images "] || data["Images"] || [];
        const imageUrl = Array.isArray(images) && images.length > 0 ? images[0] : "placeholder.jpg";

        allProducts.push({
  id: `${category.trim()}-${doc.id}`, // unique ID for every product
  name,
  price,
  mrp,
  description,
  images,
  image: imageUrl,
  category: category.trim()
});
      });
    }

    container.innerHTML = "";

    if (allProducts.length === 0) {
      container.innerHTML = "<p>No products found in database.</p>";
      return;
    }

    // üß© Render products
    allProducts.forEach(p => {
      const card = document.createElement("div");
      card.classList.add("wrapper");
      card.innerHTML = `
        <div class="container">
          <div class="top">
            <a href="#"><img src="${p.image}" alt="${p.name}" /></a>
            <div class="wishlist-btn"><i class="fa-regular fa-heart"></i></div>
          </div>
          <div class="bottom">
            <div class="left">
              <div class="details">
                <h1>${p.name}</h1>
                <p>‚Çπ${p.price}</p>
                <p class="mrp">MRP: ‚Çπ${p.mrp}</p>
              </div>
              <div class="buy"><i class="material-icons">add_shopping_cart</i></div>
              <div class="buy-now">BUY<br>NOW</div>
            </div>
          </div>
        </div>
      `;

      const productData = { ...p };

      // ‚ù§Ô∏è Wishlist toggle
      const wBtn = card.querySelector(".wishlist-btn i");
      wBtn.addEventListener("click", () => {
        let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];
        const uniqueKey = `${p.id}-${p.name}-${p.category}`.toLowerCase();
        const exists = wishlist.find(item => item.uniqueKey === uniqueKey);

        if (exists) {
          wishlist = wishlist.filter(item => item.uniqueKey !== uniqueKey);
          wBtn.classList.replace("fa-solid", "fa-regular");
          wBtn.style.color = "white";
        } else {
          productData.uniqueKey = uniqueKey;
          wishlist.push(productData);
          wBtn.classList.replace("fa-regular", "fa-solid");
          wBtn.style.color = "#ff4d6d";
        }
        localStorage.setItem("wishlist", JSON.stringify(wishlist));
      });

      // üõí Add to cart
      card.querySelector(".buy i").addEventListener("click", () => addToCartUniversal(productData));

      // ‚ö° Buy now
      card.querySelector(".buy-now").addEventListener("click", () => {
        addToCartUniversal(productData);
        window.location.href = "cart.html";
      });

      // üîç Product details
      card.querySelector(".top a").addEventListener("click", e => {
        e.preventDefault();
        localStorage.setItem("selectedProduct", JSON.stringify(productData));
        window.location.href = "productdetails.html";
      });

      container.appendChild(card);
    });

    // ‚úÖ View Toggle
    const viewBtns = document.querySelectorAll(".view-toggle .view-btn");
    const productContainer = document.querySelector(".product-container");

    // Default view = 2 columns
    productContainer.classList.add("view-2");
    productContainer.classList.remove("view-1", "view-4");

    viewBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const columns = btn.dataset.columns;
        viewBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        productContainer.classList.remove("view-1", "view-2", "view-4");
        productContainer.classList.add(`view-${columns}`);
      });
    });

  } catch (err) {
    console.error("‚ùå Error loading products:", err);
    container.innerHTML = `<p style="color:red;">Error loading products: ${err.message}</p>`;
  }
}

document.addEventListener("DOMContentLoaded", loadAllHandbags);
</script>
<script>
window.addEventListener("scroll", function() {
  const text = document.getElementById("bannerText");
  if (window.scrollY > 100) text.classList.add("hide");
  else text.classList.remove("hide");
});
</script>
</body>
</html>